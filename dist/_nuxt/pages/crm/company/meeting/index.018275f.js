(this.webpackJsonp=this.webpackJsonp||[]).push([[29],{1208:function(t,e,n){"use strict";n.r(e);n(21),n(22),n(584),n(12),n(10),n(407),n(25),n(53);var o=n(1),r=n.n(o),c={data:function(){return{times:[],animateFrame:0,details:"",nowTime:0,diffTime:0,startTime:0,isRunning:!1,companyName:"Test",signature:"",company:"",customer:"",lat:0,lng:0,addedItems:[{customer:"",data:""}]}},created:function(){var t=this;navigator.geolocation.getCurrentPosition((function(e){t.lat=e.coords.latitude,t.lng=e.coords.longitude}));var e=[];console.log("active",this.activeBusinessInfo),this.$fireStore.collection("apps").doc("users").collection(this.activeBusinessInfo.b_uid).doc("info").collection("general").where("company_id","==",this.activeCompanyInfo.id).onSnapshot((function(t){t.docChanges().forEach((function(t){var n=t.doc;e.push({company_id:n.data().company_id,status:n.data().status,online_status:n.data().online_status,role:n.data().role,uid:n.data().uid,display_name:n.data().display_name,photoURL:n.data().photoURL,email:n.data().email,name:n.data().name,surname:n.data().surname,company:n.data().company,position:n.data().position,branch:n.data().branch,push_notes:n.data().push_notes,verified:n.data().verified,last_active:n.data().last_active,created_month:n.data().created_month,timestamp:n.data().timestamp})}))})),this.$store.commit("crm/UPDATE_STAFF",e)},methods:{AddMoreProd:function(){this.addedItems.push({customer:"",data:""})},undo:function(){this.$refs.signaturePad.undoSignature()},save:function(){var t=this.$refs.signaturePad.saveSignature(),data=(t.isEmpty,t.data);this.signature=data},saves:function(t){var e=this.$refs.signaturePads[t].saveSignature(),data=(e.isEmpty,e.data);this.addedItems[t].data=data},setSubtractStartTime:function(time){time=void 0!==time?time:0;this.startTime=Math.floor(performance.now()-time)},startTimer:function(){var t=this;t.setSubtractStartTime(t.diffTime),function e(){t.nowTime=Math.floor(performance.now()),t.diffTime=t.nowTime-t.startTime,t.animateFrame=requestAnimationFrame(e)}(),t.isRunning=!0},stopTimer:function(){this.isRunning=!1,cancelAnimationFrame(this.animateFrame)},pushTime:function(){this.times.push({hours:this.hours,minutes:this.minutes,seconds:this.seconds,milliSeconds:this.milliSeconds})},clearAll:function(){this.startTime=0,this.nowTime=0,this.diffTime=0,this.times=[],this.stopTimer(),this.animateFrame=0},saveMeetings:function(){for(var t=Object.values(this.addedItems),e=[],i=0;i<t.length;i++){var n={};n.img=t[i].data,n.name=t[i].customer.name,n.surname=t[i].customer.surname,n.id=t[i].customer.uid,n.email=t[i].customer.email,n.position=t[i].customer.position,e.push(n)}var o=this;this.$fireStore.collection("apps").doc("crm").collection(this.activeBusinessInfo.b_uid).doc("company").collection("company").doc(this.activeCompanyInfo.id).collection("customermeetings").add({uid:this.activeUserInfo.uid,user_name:this.activeUserInfo.name,user_surname:this.activeUserInfo.surname,user_displayName:this.activeUserInfo.display_name,user_branch:this.activeUserInfo.branch,user_positions:this.activeUserInfo.position,startTime:this.startTime,endTime:this.diffTime,time:this.nowTime,hours:this.hours,minutes:this.minutes,seconds:this.seconds,milliSeconds:this.milliSeconds,company:this.activeCompanyInfo.company,details:this.details,customers:e,companyID:this.activeCompanyInfo.id,company_id:this.activeCompanyInfo.id,signature:this.signature,geolocation:{lat:this.lat,lng:this.lng},created_date:r()().format("DD-MM-YYYY"),created_month:r()().format("MM-YYYY"),timestamp:Date.now()}).then((function(){o.companyUpdate()})).catch((function(t){o.noSuccessUpload(t)})),this.$router.go(-1)},companyUpdate:function(){var t=this;this.$fireStore.collection("apps").doc("crm").collection(this.activeBusinessInfo.b_uid).doc("company").collection("company").doc(this.activeCompanyInfo.id).update({lastMeeting:r()().format("DD-MM-YYYY")}).then((function(){t.successUpload()})).catch((function(e){t.noSuccessUpload(e)}))},noSuccessUpload:function(t){this.$vs.notify({color:"red",title:"Oops! Something wrong",text:"Here it is: ".concat(t)})},successUpload:function(){this.$vs.notify({color:"success",title:"Upload Success",text:"Whoop whoop, been uploaded"})}},computed:{google_place:function(){return this.$store.getters["google/google_place"]},google_marker:function(){return this.$store.getters["google/google_marker"]},hours:function(){return Math.floor(this.diffTime/1e3/60/60)},minutes:function(){return Math.floor(this.diffTime/1e3/60)%60},seconds:function(){return Math.floor(this.diffTime/1e3)%60},milliSeconds:function(){return Math.floor(this.diffTime%1e3)},activeBusinessInfo:function(){return this.$store.state.business.app_active_business},activeUserInfo:function(){return this.$store.state.user.app_displayed_user},activeCompanyInfo:function(){return this.$store.state.crm.company},activeStaff:function(){return this.$store.getters["crm/staff"]}},filters:{zeroPad:function(t,e){e=void 0!==e?e:2;return t.toString().padStart(e,"0")}}},d=n(7),component=Object(d.a)(c,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("vs-card",{staticClass:"mt-10"},[n("p",{staticClass:"mt-10"},[t._v("\n      Elapsed Time:\n      "+t._s(t.hours)+" : "+t._s(t._f("zeroPad")(t.minutes))+" : "+t._s(t._f("zeroPad")(t.seconds))+" :\n      "+t._s(t._f("zeroPad")(t.milliSeconds,3))+"\n    ")]),t._v(" "),n("vs-button",{attrs:{disabled:t.isRunning},on:{click:t.startTimer}},[t._v("START")]),t._v(" "),n("vs-button",{attrs:{disabled:!t.isRunning},on:{click:t.pushTime}},[t._v("LAP")]),t._v(" "),n("vs-button",{attrs:{disabled:!t.isRunning},on:{click:t.stopTimer}},[t._v("STOP")]),t._v(" "),n("vs-button",{on:{click:t.clearAll}},[t._v("CLEAR")]),t._v(" "),t.times.length?n("ul",t._l(t.times,(function(e){return n("li",{key:e},[t._v("\n        "+t._s(e.hours)+" : "+t._s(t._f("zeroPad")(e.minutes))+" :\n        "+t._s(t._f("zeroPad")(e.seconds))+" :\n        "+t._s(t._f("zeroPad")(e.milliSeconds,3))+"\n      ")])})),0):t._e(),t._v(" "),n("vs-textarea",{staticClass:"w-full mt-5",attrs:{label:"Description"},model:{value:t.details,callback:function(e){t.details=e},expression:"details"}}),t._v(" "),n("div",t._l(t.addedItems,(function(e,o){return n("div",{key:e.index},[n("vs-select",{staticClass:"w-full mt-5",attrs:{label:"Customer"},model:{value:e.customer,callback:function(n){t.$set(e,"customer",n)},expression:"addedItem.customer"}},t._l(t.activeStaff,(function(t){return n("vs-select-item",{key:t.text,attrs:{value:t,text:t.name+" "+t.surname}})})),1),t._v(" "),n("div",{staticClass:"mt-5",attrs:{id:"app"}},[n("VueSignaturePad",{ref:"signaturePads",refInFor:!0,staticClass:"mt-5",staticStyle:{border:"solid grey 1px"},attrs:{width:"100%",height:"30%"}}),t._v(" "),n("div",{staticClass:"mt-5"},[n("vs-button",{on:{click:function(e){return t.saves(o)}}},[t._v("Save")]),t._v(" "),n("vs-button",{on:{click:t.undo}},[t._v("Undo")])],1)],1)],1)})),0),t._v(" "),n("div",{staticClass:"mt-5"},[n("vs-button",{on:{click:t.AddMoreProd}},[t._v("Add another Customer")])],1),t._v(" "),n("VueSignaturePad",{ref:"signaturePad",staticClass:"mt-5",staticStyle:{border:"solid grey 1px"},attrs:{width:"100%",height:"30%"}}),t._v(" "),n("div",{staticClass:"mt-5"},[n("vs-button",{on:{click:t.save}},[t._v("Save")]),t._v(" "),n("vs-button",{on:{click:t.undo}},[t._v("Undo")])],1),t._v(" "),n("img",{attrs:{src:this.signature,alt:""}}),t._v(" "),n("div",{staticClass:"mt-5"},[n("vs-button",{on:{click:function(e){return t.saveMeetings()}}},[t._v("Save Meeting")])],1)],1)],1)}),[],!1,null,null,null);e.default=component.exports}}]);